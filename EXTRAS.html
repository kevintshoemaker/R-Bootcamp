<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="" />


<title>FINAL EXAMPLE</title>

<script src="site_libs/header-attrs-2.24/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/journal.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.13.2/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>









<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">UNR R workshop, Fall 2023</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Workshop #1: getting started
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="module1_1.html">Submodule 1.1: working with objects</a>
    </li>
    <li>
      <a href="module1_2.html">Submodule 1.2: managing data</a>
    </li>
    <li>
      <a href="module1_3.html">Submodule 1.3: plotting in ggplot2</a>
    </li>
    <li>
      <a href="module1_4.html">Submodule 1.4: data wrangling</a>
    </li>
    <li>
      <a href="EXTRAS.html">Submodule 1.5: final demo</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Workshop #2: beyond the basics
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="module2_1.html">Submodule 2.1: R packages</a>
    </li>
    <li>
      <a href="module2_2.html">Submodule 2.2: Programming in R</a>
    </li>
    <li>
      <a href="module2_3.html">Submodule 2.3: Stats in R</a>
    </li>
    <li>
      <a href="module2_4.html">Submodule 2.4: Spatial analysis in R</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Data sets
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="data.dat">Example: tab-separated data</a>
    </li>
    <li>
      <a href="data.csv">Example: comma-separated data</a>
    </li>
    <li>
      <a href="data.txt">Example: whitespace-separated data</a>
    </li>
    <li>
      <a href="data_missing.txt">Example: missing data</a>
    </li>
    <li>
      <a href="MTMetStations.csv">Meteorological Data</a>
    </li>
    <li>
      <a href="sculpineggs.csv">Sculpin Data</a>
    </li>
    <li>
      <a href="turtle_data.txt">Turtle Data</a>
    </li>
    <li>
      <a href="geneData.csv">Gene Data</a>
    </li>
    <li>
      <a href="reptiles.csv">Reptile Data</a>
    </li>
    <li>
      <a href="comm_data.txt">Comm Data</a>
    </li>
    <li>
      <a href="data.zip">GIS Data</a>
    </li>
  </ul>
</li>
<li>
  <a href="Links.html">Links</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">FINAL EXAMPLE</h1>
<h4 class="author"></h4>
<h4 class="date">Fall 2023</h4>

</div>


<div id="load-script-for-final-demo" class="section level2">
<h2>Load script for final demo</h2>
<ol style="list-style-type: decimal">
<li><p>Click <a href="EXTRAS.R">here</a> to download the script! Save
the script to the project directory you set up in the previous
submodule.</p></li>
<li><p>Load your script in RStudio. To do this, open RStudio and click
on the folder icon in the toolbar at the top to load your
script.</p></li>
</ol>
</div>
<div id="a-demo-of-r-in-action" class="section level2">
<h2>A demo of R in action</h2>
<p>Before we get into the basics, let’s just run through some of what R
can do! Don’t worry if you don’t understand something- we will go over
all of this in greater detail later!</p>
<p>To get started, let’s first load some R packages that help with data
wrangling and exploration</p>
<p>Packages in the CRAN repository can be installed using the function
“install.packages()”:</p>
<pre class="r"><code># R DEMO ----------------------  
#     don&#39;t worry if you don&#39;t understand this just yet- this is just a 
#     taste of where we are going!


# Install packages 
#   NOTE you only have to do this once. If you have not already installed the packages, you can uncomment and run the following lines:

# install.packages(c(&quot;ggplot2&quot;,&quot;tidyverse&quot;))</code></pre>
<p>Alternatively, you can use the “packages” tab in Rstudio (lower
right) and use the “install” button.</p>
<p>Once packages are installed, you can load them into your workspace
(so they are useable in your R session) using the “library()”
function:</p>
<pre class="r"><code># Load packages 

library(ggplot2)
library(tidyverse)
library(Lahman)    # for getting baseball data</code></pre>
<p>Next we can load in some data. To give you a sense of what R can do,
let’s load in some relatively complex datasets. These datasets happen to
be about baseball, but they can stand in for any complex datasets you
might encounter in your work!</p>
<pre class="r"><code># Read in data (from the web) 

salaries &lt;- read_csv(&quot;http://dgrtwo.github.io/pages/lahman/Salaries.csv&quot;)

master &lt;- read_csv(&quot;http://dgrtwo.github.io/pages/lahman/Master.csv&quot;)

batting &lt;- read_csv(&quot;http://dgrtwo.github.io/pages/lahman/Batting.csv&quot;)

# Read in data from package (you can read in all of these from the Lahman package!)

fielding &lt;- tibble(Lahman::Fielding)</code></pre>
<p>Let’s examine these data objects in r. Again, we will get into this
in more detail later!</p>
<pre class="r"><code># explore the data 

salaries</code></pre>
<pre><code>## # A tibble: 23,956 × 5
##    yearID teamID lgID  playerID   salary
##     &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;       &lt;dbl&gt;
##  1   1985 BAL    AL    murraed02 1472819
##  2   1985 BAL    AL    lynnfr01  1090000
##  3   1985 BAL    AL    ripkeca01  800000
##  4   1985 BAL    AL    lacyle01   725000
##  5   1985 BAL    AL    flanami01  641667
##  6   1985 BAL    AL    boddimi01  625000
##  7   1985 BAL    AL    stewasa01  581250
##  8   1985 BAL    AL    martide01  560000
##  9   1985 BAL    AL    roeniga01  558333
## 10   1985 BAL    AL    mcgresc01  547143
## # ℹ 23,946 more rows</code></pre>
<pre class="r"><code># summary(salaries)    # summary statistics for all variables in data frame

master</code></pre>
<pre><code>## # A tibble: 18,354 × 24
##    playerID  birthYear birthMonth birthDay birthCountry birthState birthCity   
##    &lt;chr&gt;         &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;        &lt;chr&gt;      &lt;chr&gt;       
##  1 aardsda01      1981         12       27 USA          CO         Denver      
##  2 aaronha01      1934          2        5 USA          AL         Mobile      
##  3 aaronto01      1939          8        5 USA          AL         Mobile      
##  4 aasedo01       1954          9        8 USA          CA         Orange      
##  5 abadan01       1972          8       25 USA          FL         Palm Beach  
##  6 abadfe01       1985         12       17 D.R.         La Romana  La Romana   
##  7 abadijo01      1854         11        4 USA          PA         Philadelphia
##  8 abbated01      1877          4       15 USA          PA         Latrobe     
##  9 abbeybe01      1869         11       11 USA          VT         Essex       
## 10 abbeych01      1866         10       14 USA          NE         Falls City  
## # ℹ 18,344 more rows
## # ℹ 17 more variables: deathYear &lt;dbl&gt;, deathMonth &lt;dbl&gt;, deathDay &lt;dbl&gt;,
## #   deathCountry &lt;chr&gt;, deathState &lt;chr&gt;, deathCity &lt;chr&gt;, nameFirst &lt;chr&gt;,
## #   nameLast &lt;chr&gt;, nameGiven &lt;chr&gt;, weight &lt;dbl&gt;, height &lt;dbl&gt;, bats &lt;chr&gt;,
## #   throws &lt;chr&gt;, debut &lt;date&gt;, finalGame &lt;date&gt;, retroID &lt;chr&gt;, bbrefID &lt;chr&gt;</code></pre>
<pre class="r"><code># summary(master)

batting</code></pre>
<pre><code>## # A tibble: 97,889 × 24
##    playerID  yearID stint teamID lgID      G G_batting    AB     R     H  `2B`
##    &lt;chr&gt;      &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt; &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1 aardsda01   2004     1 SFN    NL       11        11     0     0     0     0
##  2 aardsda01   2006     1 CHN    NL       45        43     2     0     0     0
##  3 aardsda01   2007     1 CHA    AL       25         2     0     0     0     0
##  4 aardsda01   2008     1 BOS    AL       47         5     1     0     0     0
##  5 aardsda01   2009     1 SEA    AL       73         3     0     0     0     0
##  6 aardsda01   2010     1 SEA    AL       53         4     0     0     0     0
##  7 aardsda01   2012     1 NYA    AL        1        NA    NA    NA    NA    NA
##  8 aaronha01   1954     1 ML1    NL      122       122   468    58   131    27
##  9 aaronha01   1955     1 ML1    NL      153       153   602   105   189    37
## 10 aaronha01   1956     1 ML1    NL      153       153   609   106   200    34
## # ℹ 97,879 more rows
## # ℹ 13 more variables: `3B` &lt;dbl&gt;, HR &lt;dbl&gt;, RBI &lt;dbl&gt;, SB &lt;dbl&gt;, CS &lt;dbl&gt;,
## #   BB &lt;dbl&gt;, SO &lt;dbl&gt;, IBB &lt;dbl&gt;, HBP &lt;dbl&gt;, SH &lt;dbl&gt;, SF &lt;dbl&gt;, GIDP &lt;dbl&gt;,
## #   G_old &lt;dbl&gt;</code></pre>
<pre class="r"><code># summary(batting)

fielding</code></pre>
<pre><code>## # A tibble: 149,365 × 18
##    playerID  yearID stint teamID lgID  POS       G    GS InnOuts    PO     A
##    &lt;chr&gt;      &lt;int&gt; &lt;int&gt; &lt;fct&gt;  &lt;fct&gt; &lt;chr&gt; &lt;int&gt; &lt;int&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;
##  1 abercda01   1871     1 TRO    NA    SS        1     1      24     1     3
##  2 addybo01    1871     1 RC1    NA    2B       22    22     606    67    72
##  3 addybo01    1871     1 RC1    NA    SS        3     3      96     8    14
##  4 allisar01   1871     1 CL1    NA    2B        2     0      18     1     4
##  5 allisar01   1871     1 CL1    NA    OF       29    29     729    51     3
##  6 allisdo01   1871     1 WS3    NA    C        27    27     681    68    15
##  7 ansonca01   1871     1 RC1    NA    1B        1     0      15     7     0
##  8 ansonca01   1871     1 RC1    NA    2B        2     1      30     3     4
##  9 ansonca01   1871     1 RC1    NA    3B       20    19     555    38    52
## 10 ansonca01   1871     1 RC1    NA    C         5     4      93    10     0
## # ℹ 149,355 more rows
## # ℹ 7 more variables: E &lt;int&gt;, DP &lt;int&gt;, PB &lt;int&gt;, WP &lt;int&gt;, SB &lt;int&gt;,
## #   CS &lt;int&gt;, ZR &lt;int&gt;</code></pre>
<pre class="r"><code># summary(fielding)</code></pre>
<p>Before we can do much with these data, we need to “wrangle” these
data into a format that can be visualized and analyzed effectively.</p>
<p>Let’s begin by merging these datasets into a single master
dataset…</p>
<pre class="r"><code># Do some wrangling! 

 # merge the batting and salaries data frames
merged.batting = left_join(batting, salaries, by=c(&quot;playerID&quot;, &quot;yearID&quot;, &quot;teamID&quot;, &quot;lgID&quot;))

 # merge the &quot;master&quot; dataset (player biographical info)
merged.bio = inner_join(merged.batting, master, by=&quot;playerID&quot;)

 # summarize fielding data by year and player- prepare to merge with other data
fielding.temp = fielding %&gt;% 
  group_by(playerID,yearID,teamID,lgID) %&gt;%     # 
  summarize(position = first(modeest::mfv(POS)),
            games = sum(G))

merged.all = inner_join(merged.bio,fielding.temp,by=c(&quot;playerID&quot;, &quot;yearID&quot;, &quot;teamID&quot;, &quot;lgID&quot;))
merged.all = merged.all %&gt;%    # remove all rows with no at-bats... 
  filter( AB &gt; 0 )

# range(merged.all$AB)

merged.all = merged.all %&gt;%     # make a new column with the full name
  mutate(name=paste(nameFirst, nameLast))</code></pre>
<p>Now let’s summarize the data by player and start to get a sense for
what patterns we can detect.</p>
<pre class="r"><code># summarize by player 

summarized.batters = merged.all %&gt;% 
  group_by(playerID) %&gt;% 
  summarise(name=first(name),
            League=first(modeest::mfv(lgID)),
            Position=first(modeest::mfv(position)),
            First.yr=min(yearID),
            Total.HR=sum(HR),
            Total.R=sum(R),
            Total.H=sum(H),
            AB=sum(AB),
            BattingAverage=sum(H) / sum(AB) ) %&gt;% 
  arrange(desc(Total.HR))


# visualize the data 

  # visualize correlation between hits and runs
ggplot(summarized.batters, aes(Total.H, Total.R)) + geom_point()</code></pre>
<p><img src="EXTRAS_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<pre class="r"><code>  # visualize histogram of batting average
ggplot(summarized.batters, aes(BattingAverage)) + geom_histogram()</code></pre>
<p><img src="EXTRAS_files/figure-html/unnamed-chunk-6-2.png" width="672" /></p>
<pre class="r"><code>  # remove &quot;outliers&quot; and try again
summarized.batters = summarized.batters %&gt;% 
  filter(AB&gt;100&amp;First.yr&gt;1920)

ggplot(summarized.batters, aes(BattingAverage)) + geom_histogram()</code></pre>
<p><img src="EXTRAS_files/figure-html/unnamed-chunk-6-3.png" width="672" /></p>
<pre class="r"><code>ggplot(summarized.batters, aes(BattingAverage,col=League)) + geom_density()</code></pre>
<p><img src="EXTRAS_files/figure-html/unnamed-chunk-6-4.png" width="672" /></p>
<pre class="r"><code># Why does NL density plot indicate a sizable number of players with very low batting average?

# make a new variable to indicate whether each player is a pitcher or position player

summarized.batters = summarized.batters %&gt;% 
  mutate(Pitcher=ifelse(Position==&quot;P&quot;,&quot;Pitcher&quot;,&quot;Position Player&quot;))

ggplot(summarized.batters, aes(BattingAverage)) + 
    geom_histogram(aes(y = ..density..,group=Pitcher)) + 
  geom_density(aes(col=Pitcher),lwd=1.5) +
    stat_function(
        fun = dnorm, 
        args = with(summarized.batters, c(mean = mean(BattingAverage[Position!=&quot;P&quot;]), 
                                          sd = sd(BattingAverage[Position!=&quot;P&quot;]))),
        col=&quot;lightblue&quot;,lwd=1.1
        )   + 
   stat_function(
        fun = dnorm, 
        args = with(summarized.batters, c(mean = mean(BattingAverage[Position==&quot;P&quot;]), 
                                          sd = sd(BattingAverage[Position==&quot;P&quot;]))),
        col=&quot;pink&quot;,lwd=1.1
        )   +
     labs(x=&quot;Batting Average&quot;,title = &quot;Histogram with Normal Curve&quot;)  </code></pre>
<p><img src="EXTRAS_files/figure-html/unnamed-chunk-6-5.png" width="672" /></p>
<p>This time, let’s look for some time trends by summarizing by
year.</p>
<pre class="r"><code># Summmarize by time (and league) 

summarized.year = merged.all %&gt;% 
  filter(yearID&gt;1920) %&gt;%
  group_by(yearID,lgID) %&gt;% 
  summarise(Total.HR=sum(HR),
            Total.R=sum(R),
            Total.H=sum(H),
            AB=sum(AB),
            BattingAverage=sum(H) / sum(AB) ) %&gt;% 
  arrange(yearID, lgID)


summarized.year</code></pre>
<pre><code>## # A tibble: 186 × 7
## # Groups:   yearID [93]
##    yearID lgID  Total.HR Total.R Total.H    AB BattingAverage
##     &lt;dbl&gt; &lt;chr&gt;    &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;          &lt;dbl&gt;
##  1   1921 AL         477    6290   12509 42762          0.293
##  2   1921 NL         460    5631   12266 42367          0.290
##  3   1922 AL         525    5863   12034 42292          0.285
##  4   1922 NL         530    6190   12576 43041          0.292
##  5   1923 AL         442    5884   11870 42002          0.283
##  6   1923 NL         538    5984   12346 43203          0.286
##  7   1924 AL         397    6132   12261 42215          0.290
##  8   1924 NL         498    5577   12004 42430          0.283
##  9   1925 AL         533    6397   12419 42567          0.292
## 10   1925 NL         636    6193   12492 42845          0.292
## # ℹ 176 more rows</code></pre>
<pre class="r"><code># visualize the data 

  # visualize trend in home runs
ggplot(summarized.year, aes(yearID, Total.HR, col=lgID)) + 
  geom_line()</code></pre>
<p><img src="EXTRAS_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<pre class="r"><code>  # visualize trend in batting average
ggplot(summarized.year, aes(yearID, BattingAverage, col=lgID)) + 
  geom_line()</code></pre>
<p><img src="EXTRAS_files/figure-html/unnamed-chunk-7-2.png" width="672" /></p>
<p>Finally let’s do some more complex visualizations and run some
statistics…</p>
<pre class="r"><code># Summarize by time and team

summarized.teams.year = merged.all %&gt;%
  filter(yearID&gt;1920) %&gt;%
  group_by(yearID,teamID) %&gt;% 
  summarise(League = first(lgID),
            Total.HR=sum(HR),
            Total.R=sum(R),
            Total.H=sum(H),
            AB=sum(AB),
            BattingAverage=sum(H) / sum(AB) ) %&gt;% 
  arrange(desc(Total.HR))


summarized.teams.year</code></pre>
<pre><code>## # A tibble: 2,026 × 8
## # Groups:   yearID [93]
##    yearID teamID League Total.HR Total.R Total.H    AB BattingAverage
##     &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;     &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;          &lt;dbl&gt;
##  1   1997 SEA    AL          264     924    1574  5614          0.280
##  2   2005 TEX    AL          260     865    1528  5716          0.267
##  3   2010 TOR    AL          257     755    1364  5495          0.248
##  4   2000 HOU    NL          249     938    1547  5566          0.278
##  5   1996 BAL    AL          247     913    1498  5459          0.274
##  6   2001 TEX    AL          246     890    1566  5685          0.275
##  7   1996 SEA    AL          245     993    1625  5663          0.287
##  8   2012 NYA    AL          245     804    1462  5524          0.265
##  9   1999 SEA    AL          244     859    1499  5572          0.269
## 10   2000 TOR    AL          244     861    1562  5677          0.275
## # ℹ 2,016 more rows</code></pre>
<pre class="r"><code># visualize the data 

  # visualize correlation between home runs and year
ggplot(summarized.teams.year, aes(yearID, Total.HR)) + 
  geom_point(show.legend = FALSE) +
  geom_smooth() +
  facet_wrap(&#39;League&#39;)</code></pre>
<p><img src="EXTRAS_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<p>Let’s run a statistical analysis to see if the increasing home run
trend is “real”.</p>
<pre class="r"><code>ggplot(summarized.teams.year,aes(yearID,Total.HR))+
  geom_point() +
  geom_smooth(method=&quot;lm&quot;)</code></pre>
<p><img src="EXTRAS_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
<pre class="r"><code>model1 &lt;- lm(Total.HR~yearID,summarized.teams.year)  # linear regression analysis
summary(model1)</code></pre>
<pre><code>## 
## Call:
## lm(formula = Total.HR ~ yearID, data = summarized.teams.year)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -102.388  -26.357   -3.177   22.578  127.902 
## 
## Coefficients:
##               Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) -2.073e+03  6.058e+01  -34.23   &lt;2e-16 ***
## yearID       1.114e+00  3.069e-02   36.31   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 36.61 on 2024 degrees of freedom
## Multiple R-squared:  0.3945, Adjusted R-squared:  0.3942 
## F-statistic:  1318 on 1 and 2024 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>Then we can perform some diagnostic tests to make sure the data meet
the assumptions of the analysis:</p>
<pre class="r"><code># test key assumptions visually

layout(matrix(1:4,nrow=2,byrow=T))  # set up graphics window
plot(model1)  # run diagnostic plots for our regression</code></pre>
<p><img src="EXTRAS_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
<p>With just minor changes to the above code, we could look at many
additional questions!</p>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
