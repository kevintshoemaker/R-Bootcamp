<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />


<meta name="author" content="The Tidyverse and Data Wrangling in R (C. Albano)" />


<title>Module 2.2</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/journal.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 61px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 66px;
  margin-top: -66px;
}

.section h2 {
  padding-top: 66px;
  margin-top: -66px;
}
.section h3 {
  padding-top: 66px;
  margin-top: -66px;
}
.section h4 {
  padding-top: 66px;
  margin-top: -66px;
}
.section h5 {
  padding-top: 66px;
  margin-top: -66px;
}
.section h6 {
  padding-top: 66px;
  margin-top: -66px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->




<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 25px;
  text-indent: 0;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">R bootcamp, Fall 2018</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Bootcamp #1: getting started
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="module1_1.html">Module 1.1: Getting started: working with objects</a>
    </li>
    <li>
      <a href="module1_2.html">Module 1.2: Getting started: managing data</a>
    </li>
    <li>
      <a href="module1_3.html">Module 1.3: Getting started: plotting and basic stats</a>
    </li>
    <li>
      <a href="module1_4.html">Module 1.4: Getting started: expanding your skill set</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Bootcamp #2: beyond the basics
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="module2_1.html">Module 2.1: Programming in R</a>
    </li>
    <li>
      <a href="module2_2.html">Module 2.2: Using the 'tidyvierse'</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Data sets
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="turtle_data.txt">Turtle Data</a>
    </li>
  </ul>
</li>
<li>
  <a href="Links.html">Links</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Module 2.2</h1>
<h4 class="author"><em>The Tidyverse and Data Wrangling in R (C. Albano)</em></h4>
<h4 class="date"><em>September 2018</em></h4>

</div>


<p><strong>Guest presenter</strong>: Christine Albano (who also pulled this module together!)</p>
<p>In this tutorial we introduce the ‘Tidyverse’ set of packages, which were designed to facilitate everyday data management and visualization tasks in R using a consistent data structure and syntax. Much of the content in this tutorial is based on the online resource <a href="http://r4ds.had.co.nz/">R for Data Science</a> by Garrett Grolemund and Hadley Wickham.</p>
<div class="figure">
<img src="http://r4ds.had.co.nz/diagrams/data-science-wrangle.png" />

</div>
<p>The core tidyverse set of packages includes all of the below (plus a handfull of others). For now, just focused on the first four for data wrangling:</p>
<ul>
<li><p>dplyr, for data manipulation</p></li>
<li><p>tidyr, for data tidying</p></li>
<li><p>readr, for data import</p></li>
<li><p>tibble, for tibbles, a modern re-imagining of data frames</p></li>
<li><p>ggplot2, for data visualisation</p></li>
<li><p>purrr, for functional programming</p></li>
<li><p>stringr, for strings</p></li>
<li><p>forcats, for factors</p></li>
</ul>
<div id="learning-goals" class="section level1">
<h1>Learning goals</h1>
<ul>
<li><p>Use <em>Tidyverse</em> grammar (piping) and data structures to perform basic data manipulation tasks</p></li>
<li><p>Use <em>tidyr</em> and <em>dplyr</em> data transformation verbs to wrangle data</p></li>
<li><p>Work with and parse dates using <em>lubridate</em></p></li>
</ul>
<pre class="r"><code># install.packages(&quot;tidyverse&quot;)
library(tidyverse)</code></pre>
</div>
<div id="load-script-for-module-2.2" class="section level1">
<h1>Load script for module #2.2</h1>
<ol style="list-style-type: decimal">
<li><p>Click <a href="module2_2.R">here</a> to download the script! Save the script to a convenient folder on your laptop.</p></li>
<li><p>Load your script in RStudio.</p></li>
</ol>
</div>
<div id="using-the-pipe-operator-in-r" class="section level1">
<h1>Using the pipe operator <code>%&gt;%</code> in R</h1>
<p>The ‘tidyverse’ set of packages takes advantage of the pipe operator <code>%&gt;%</code>, which provides a clean and intuitive way to structure code and perform sequential operations in R.</p>
<p>Key advantages include:</p>
<ul>
<li><p>code is more readable and intuitive – reads left to right, rather than inside out as is the case for nested function</p></li>
<li><p>perform multiple operations without creating a bunch of intermediate (temporary) datasets</p></li>
</ul>
<p>This operator originally comes from the <em>magrittr</em> package, which is included in the installation of all of the tidyverse packages. The shortcut for the pipe operator is ctrl-shift-m. When reading code out loud, use ‘then’ for the pipe. For example the command here:</p>
<pre><code>
x %&gt;% log() %&gt;% round(digits=2)
</code></pre>
<p>can be interpreted as follows:</p>
<blockquote>
<p>Take the object “x”, THEN take its natural logarithm, THEN round that value to 2 significant figures</p>
</blockquote>
<p>The structure is simple. Start with the object you want to manipulate, and apply actions (e.g., functions) to that object in the order in which you want to apply them.</p>
<p>Here is a quick example.</p>
<pre class="r"><code>####
####  Using the pipe operator %&gt;% (ctrl-shift-m)
####

# start with a simple example
x &lt;- 3

# calculate the log of x
log(x) # form f(x) is equivalent to</code></pre>
<pre><code>## [1] 1.098612</code></pre>
<pre class="r"><code>x %&gt;% log() # form x %&gt;% f</code></pre>
<pre><code>## [1] 1.098612</code></pre>
<pre class="r"><code># example of multiple steps in pipe
round(log(x), digits=2) # form g(f(x)) is equivalent to</code></pre>
<pre><code>## [1] 1.1</code></pre>
<pre class="r"><code>x %&gt;% log() %&gt;% round(digits=2) # form x %&gt;% f %&gt;%  g</code></pre>
<pre><code>## [1] 1.1</code></pre>
</div>
<div id="importing-data-into-r-using-readr" class="section level1">
<h1>Importing data into <em>R</em> using <em>readr</em></h1>
<p>Here, we import meteorological data from Hungry Horse and Polson Kerr Dams in Montana as a <em>tibble</em> dataframe. The <em>readr</em> package imports data as a special type of dataframe called a <em>tibble</em>. The <em>tibble</em> dataframe has several advantages over the ‘regular’ dataframe, including nicely formatted printing, more useful defaults, faster imports, and it also flags potential issues in your dataset early on – which can save you a lot of time later! All this said, tibble and regular dataframes are readily converted to one type vs. the other if the need arises.</p>
<div id="download-an-example-dataset" class="section level2">
<h2>Download an example dataset</h2>
<p>The next few examples use meteorological data from Hungry Horse (HH) and Polson Kerr (PK) dams. You can download this data set by clicking <a href="MTMetStations.csv">here</a>.</p>
</div>
<div id="import-as-a-tibble" class="section level2">
<h2>Import as a <em>tibble</em></h2>
<pre class="r"><code>####
####  Import data as a Tibble dataframe and take a quick glance
####

# import meteorological data from Hungry Horse (HH) and Polson Kerr (PK) dams as tibble dataframe using readr 
clim_data &lt;- read_csv(&quot;MTMetStations.csv&quot;)

# display tibble - note nice formatting and variable info, entire dataset is not displayed as is case in read.csv
clim_data</code></pre>
<pre><code>## # A tibble: 1,734 x 7
##    Date      PK.TMaxF PK.TMinF PK.PrcpIN HH.TMaxF HH.TMinF HH.PrcpIN
##    &lt;chr&gt;        &lt;int&gt;    &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;    &lt;int&gt;     &lt;dbl&gt;
##  1 1/1/2013        27       19      0          26       22      0   
##  2 1/2/2013        27       22      0          27       23      0   
##  3 1/3/2013        23       14      0          25       21      0   
##  4 1/4/2013        25       19      0          22       13      0   
##  5 1/5/2013        29       20      0          24       13      0   
##  6 1/6/2013        36       25      0          30       20      0.1 
##  7 1/7/2013        35       30      0.16       35       22      0.23
##  8 1/8/2013        39       32      0.04       36       25      0.32
##  9 1/9/2013        44       31      0.07       39       30      0.1 
## 10 1/10/2013       39       27      0.22       46       32      0.1 
## # ... with 1,724 more rows</code></pre>
<pre class="r"><code> # display the last few lines of the data frame
tail(clim_data)</code></pre>
<pre><code>## # A tibble: 6 x 7
##   Date      PK.TMaxF PK.TMinF PK.PrcpIN HH.TMaxF HH.TMinF HH.PrcpIN
##   &lt;chr&gt;        &lt;int&gt;    &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;    &lt;int&gt;     &lt;dbl&gt;
## 1 9/25/2017       59       47     0.001       56       39         0
## 2 9/26/2017       66       47     0           58       43         0
## 3 9/27/2017       66       41     0           68       43         0
## 4 9/28/2017       67       39     0           66       43         0
## 5 9/29/2017       70       40     0           71       38         0
## 6 9/30/2017       62       47     0.06        71       38         0</code></pre>
</div>
</div>
<div id="making-data-tidy-using-tidyr" class="section level1">
<h1>Making data tidy using <em>tidyr</em></h1>
<p>All of the tidyverse set of packages are designed to work with <em>Tidy</em> formatted data.</p>
<p>This means:</p>
<ul>
<li>Each variable must have its own column.</li>
<li>Each observation must have its own row.</li>
<li>Each value must have its own cell.</li>
</ul>
<p>This is what it looks like:</p>
<div class="figure">
<img src="http://r4ds.had.co.nz/images/tidy-1.png" />

</div>
<p>The <em>tidyr</em> package has several functions to help you get your data into this format.</p>
<p>Use “gather()” to get all of the values and variables into a single column.</p>
<div class="figure">
<img src="http://r4ds.had.co.nz/images/tidy-9.png" />

</div>
<p>Use “separate()” to separate a single column into two separate columns. “unite()” does the opposite</p>
<div class="figure">
<img src="http://r4ds.had.co.nz/images/tidy-17.png" />

</div>
<p>Use “spread()” to distribute two variables in a single (‘key’) column into separate columns, with their data values(‘value’)</p>
<div class="figure">
<img src="http://r4ds.had.co.nz/images/tidy-8.png" />

</div>
<pre class="r"><code>####
####  Use Tidyr verbs to make data &#39;tidy&#39;
####

# look at clim_data -- is it in tidy format? What do we need to do to get it there?
head(clim_data)</code></pre>
<pre><code>## # A tibble: 6 x 7
##   Date     PK.TMaxF PK.TMinF PK.PrcpIN HH.TMaxF HH.TMinF HH.PrcpIN
##   &lt;chr&gt;       &lt;int&gt;    &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;    &lt;int&gt;     &lt;dbl&gt;
## 1 1/1/2013       27       19         0       26       22       0  
## 2 1/2/2013       27       22         0       27       23       0  
## 3 1/3/2013       23       14         0       25       21       0  
## 4 1/4/2013       25       19         0       22       13       0  
## 5 1/5/2013       29       20         0       24       13       0  
## 6 1/6/2013       36       25         0       30       20       0.1</code></pre>
<pre class="r"><code># gather column names into a new column called &#39;climvar_station&#39;, and all of the numeric precip and temp values into a column called &#39;value&#39;. By including -Date, we indicate that we don&#39;t want to gather this column.
gather_clim_vars &lt;- gather(clim_data, 
                           key = climvar_station, 
                           value = value, 
                           -Date)

gather_clim_vars</code></pre>
<pre><code>## # A tibble: 10,404 x 3
##    Date      climvar_station value
##    &lt;chr&gt;     &lt;chr&gt;           &lt;dbl&gt;
##  1 1/1/2013  PK.TMaxF           27
##  2 1/2/2013  PK.TMaxF           27
##  3 1/3/2013  PK.TMaxF           23
##  4 1/4/2013  PK.TMaxF           25
##  5 1/5/2013  PK.TMaxF           29
##  6 1/6/2013  PK.TMaxF           36
##  7 1/7/2013  PK.TMaxF           35
##  8 1/8/2013  PK.TMaxF           39
##  9 1/9/2013  PK.TMaxF           44
## 10 1/10/2013 PK.TMaxF           39
## # ... with 10,394 more rows</code></pre>
<pre class="r"><code># separate the climvar_station column into two separate columns that identify the climate variable and the station
separate_clim_vars &lt;- gather_clim_vars %&gt;%
  separate(climvar_station, 
           into = c(&quot;Station&quot;,&quot;climvar&quot;))

separate_clim_vars</code></pre>
<pre><code>## # A tibble: 10,404 x 4
##    Date      Station climvar value
##    &lt;chr&gt;     &lt;chr&gt;   &lt;chr&gt;   &lt;dbl&gt;
##  1 1/1/2013  PK      TMaxF      27
##  2 1/2/2013  PK      TMaxF      27
##  3 1/3/2013  PK      TMaxF      23
##  4 1/4/2013  PK      TMaxF      25
##  5 1/5/2013  PK      TMaxF      29
##  6 1/6/2013  PK      TMaxF      36
##  7 1/7/2013  PK      TMaxF      35
##  8 1/8/2013  PK      TMaxF      39
##  9 1/9/2013  PK      TMaxF      44
## 10 1/10/2013 PK      TMaxF      39
## # ... with 10,394 more rows</code></pre>
<pre class="r"><code># spread distributes the clim_var column into separate columns, with the data values from the &#39;value&#39; column
tidy_clim_data &lt;- spread(separate_clim_vars, 
                        key = climvar, 
                        value = value)

tidy_clim_data</code></pre>
<pre><code>## # A tibble: 3,468 x 5
##    Date     Station PrcpIN TMaxF TMinF
##    &lt;chr&gt;    &lt;chr&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1 1/1/2013 HH        0       26    22
##  2 1/1/2013 PK        0       27    19
##  3 1/1/2014 HH        0       38    27
##  4 1/1/2014 PK        0       35    24
##  5 1/1/2015 HH        0        7     0
##  6 1/1/2015 PK        0        7    -1
##  7 1/1/2016 HH        0       22    15
##  8 1/1/2016 PK        0       22    17
##  9 1/1/2017 HH        0.16    30    16
## 10 1/1/2017 PK        0.34    22     7
## # ... with 3,458 more rows</code></pre>
<pre class="r"><code># repeat above as single pipe series without creation of intermediate datasets
  
tidy_clim_data &lt;- clim_data %&gt;% 
  gather(key = climvar_station,
         value = value,
         -Date) %&gt;% 
  separate(climvar_station, 
           into = c(&quot;Station&quot;,&quot;climvar&quot;)) %&gt;% 
  spread(key = climvar,
         value = value)
  
tidy_clim_data</code></pre>
<pre><code>## # A tibble: 3,468 x 5
##    Date     Station PrcpIN TMaxF TMinF
##    &lt;chr&gt;    &lt;chr&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1 1/1/2013 HH        0       26    22
##  2 1/1/2013 PK        0       27    19
##  3 1/1/2014 HH        0       38    27
##  4 1/1/2014 PK        0       35    24
##  5 1/1/2015 HH        0        7     0
##  6 1/1/2015 PK        0        7    -1
##  7 1/1/2016 HH        0       22    15
##  8 1/1/2016 PK        0       22    17
##  9 1/1/2017 HH        0.16    30    16
## 10 1/1/2017 PK        0.34    22     7
## # ... with 3,458 more rows</code></pre>
</div>
<div id="using-dplyr-the-data-wrangling-workhorse" class="section level1">
<h1>Using dplyr – the data wrangling workhorse</h1>
<p>dplyr is by far one of the most useful packages in all of the tidyverse as it allows you to quickly and easily summarize and manipulate your data once you have it in tidy form. The basic dplyr verbs include:</p>
<pre><code>  * grouping data with *group_by()*

  * filtering rows with *filter()*
  
  * creating new variables with *mutate()*
  
  * summarizing with *summarize()*
  
  * selecting columns with *select()*
  
  * sorting columns by row with *arrange()*</code></pre>
<p>you can add variants _all (affects all variables), _at (affects selected variables), _if (affects variables that meet criteria) to most of these verbs</p>
<pre class="r"><code>####
####  Use dplyr verbs to wrangle data
####

# example of simple data selection and summary using group_by, summarize, and mutate verbs

# take tidy_clim_data, then
# group data by station, then 
# calculate summaries and put in columns with names mean.precip.in, mean.TMax.F, and mean.Tmin.F, then 
# transform to metric and put in new columns mean.precip.in, mean.TMax.F, and mean.Tmin.F

station_mean1 &lt;- tidy_clim_data %&gt;%
  group_by(Station) %&gt;% 
  summarize(
    mean.precip.in = mean(PrcpIN, na.rm=TRUE),
    mean.TMax.F = mean(TMaxF, na.rm=TRUE),
    mean.TMin.F = mean(TMinF, na.rm=TRUE)) %&gt;%
  mutate(
    mean.precip.mm = mean.precip.in * 25.4,
    mean.TMax.C = (mean.TMax.F - 32) * 5 / 9,
    mean.TMin.C = (mean.TMin.F - 32) * 5 / 9
  )
  
station_mean1</code></pre>
<pre><code>## # A tibble: 2 x 7
##   Station mean.precip.in mean.TMax.F mean.TMin.F mean.precip.mm
##   &lt;chr&gt;            &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;          &lt;dbl&gt;
## 1 HH              0.0972        56.0        36.3           2.47
## 2 PK              0.0442        57.8        36.5           1.12
## # ... with 2 more variables: mean.TMax.C &lt;dbl&gt;, mean.TMin.C &lt;dbl&gt;</code></pre>
<pre class="r"><code># using variants

# take tidy_clim_data, then
# group data by station, then 
# calculate summary (mean of all non-NA values) for numeric data only, then 
# transform temp data (.) from F to C, then
# transform precip data (.) from in to mm


station_mean2 &lt;- tidy_clim_data %&gt;%
  group_by(Station) %&gt;% 
  summarize_if(is.numeric, mean, na.rm=TRUE) %&gt;%
  mutate_at(vars(TMaxF, TMinF), funs(C=(.-32)*5/9)) %&gt;% 
  mutate_at(vars(PrcpIN), funs(Prcp.mm=.*25.4))

station_mean2</code></pre>
<pre><code>## # A tibble: 2 x 7
##   Station PrcpIN TMaxF TMinF TMaxF_C TMinF_C Prcp.mm
##   &lt;chr&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
## 1 HH      0.0972  56.0  36.3    13.3    2.36    2.47
## 2 PK      0.0442  57.8  36.5    14.3    2.48    1.12</code></pre>
</div>
<div id="working-with-dates-with-lubridate---date-from-character-string" class="section level1">
<h1>Working with Dates with <em>lubridate</em> - Date from character string</h1>
<p>Dates can be tricky to work with and we often want to eventually get to the point that we can summarize our data by years, seasons, months, or even day of the year. The <em>lubridate</em> package in R (also part of the tidyverse) is very useful for creating and parsing dates for this purpose. Date/time data often comes as strings in a variety of orders/formats. Lubridate is useful because it automatically works out the date format once you specify the order of the components. To to do this, identify the order in which year, month, and day appear in your dates, then arrange “y”, “m”, and “d” in the same order. That gives you the name of the lubridate function that will parse your date. For example:</p>
<pre class="r"><code>#### 
####  Using lubridate to format and create date data types
####

library(lubridate)

date_string &lt;- (&quot;2017-01-31&quot;)

# convert date string into date format by identifing the order in which year, month, and day appear in your dates, then arrange &quot;y&quot;, &quot;m&quot;, and &quot;d&quot; in the same order. That gives you the name of the lubridate function that will parse your date

date_dtformat &lt;- ymd(date_string)

# note the different formats of the date_string and date_dtformat objects in the environment window.

# a variety of other formats/orders can also be accommodated. Note how each of these are reformatted to &quot;2017-01-31&quot; A timezone can be specified using tz=

mdy(&quot;January 31st, 2017&quot;)</code></pre>
<pre><code>## [1] &quot;2017-01-31&quot;</code></pre>
<pre class="r"><code>dmy(&quot;31-Jan-2017&quot;)</code></pre>
<pre><code>## [1] &quot;2017-01-31&quot;</code></pre>
<pre class="r"><code>ymd(20170131)</code></pre>
<pre><code>## [1] &quot;2017-01-31&quot;</code></pre>
<pre class="r"><code>ymd(20170131, tz = &quot;UTC&quot;)</code></pre>
<pre><code>## [1] &quot;2017-01-31 UTC&quot;</code></pre>
<pre class="r"><code># can also make a date from components. this is useful if you have columns for year, month, day in a dataframe
year&lt;-2017
month&lt;-1
day&lt;-31
make_date(year, month, day)</code></pre>
<pre><code>## [1] &quot;2017-01-31&quot;</code></pre>
<pre class="r"><code># times can be included as well. Note that unless otherwise specified, R assumes UTC time

ymd_hms(&quot;2017-01-31 20:11:59&quot;)</code></pre>
<pre><code>## [1] &quot;2017-01-31 20:11:59 UTC&quot;</code></pre>
<pre class="r"><code>mdy_hm(&quot;01/31/2017 08:01&quot;)</code></pre>
<pre><code>## [1] &quot;2017-01-31 08:01:00 UTC&quot;</code></pre>
<pre class="r"><code># we can also have R tell us the current time or date

now()</code></pre>
<pre><code>## [1] &quot;2018-08-26 18:25:35 PDT&quot;</code></pre>
<pre class="r"><code>now(tz = &quot;UTC&quot;)</code></pre>
<pre><code>## [1] &quot;2018-08-27 01:25:35 UTC&quot;</code></pre>
<pre class="r"><code>today()</code></pre>
<pre><code>## [1] &quot;2018-08-26&quot;</code></pre>
</div>
<div id="working-with-dates-with-lubridate---parsing-dates" class="section level1">
<h1>Working with Dates with lubridate - Parsing Dates</h1>
<p>Once dates are in date format, we can easily pull out their individual components like this:</p>
<pre class="r"><code>####
####  Parsing dates with lubridate
####

datetime &lt;- ymd_hms(&quot;2016-07-08 12:34:56&quot;)

# year
year(datetime)</code></pre>
<pre><code>## [1] 2016</code></pre>
<pre class="r"><code># month as numeric
month(datetime)</code></pre>
<pre><code>## [1] 7</code></pre>
<pre class="r"><code># month as name
month(datetime, label = TRUE)</code></pre>
<pre><code>## [1] Jul
## 12 Levels: Jan &lt; Feb &lt; Mar &lt; Apr &lt; May &lt; Jun &lt; Jul &lt; Aug &lt; Sep &lt; ... &lt; Dec</code></pre>
<pre class="r"><code># day of month
mday(datetime)</code></pre>
<pre><code>## [1] 8</code></pre>
<pre class="r"><code># day of year (julian day)
yday(datetime)</code></pre>
<pre><code>## [1] 190</code></pre>
<pre class="r"><code># day of week
wday(datetime)</code></pre>
<pre><code>## [1] 6</code></pre>
<pre class="r"><code>wday(datetime, label = TRUE, abbr = FALSE)</code></pre>
<pre><code>## [1] Friday
## 7 Levels: Sunday &lt; Monday &lt; Tuesday &lt; Wednesday &lt; Thursday &lt; ... &lt; Saturday</code></pre>
<div id="working-with-dates---parsing-dates-example" class="section level2">
<h2>Working with Dates - Parsing Dates Example</h2>
<p>We can use lubridate and dplyr to make new columns from a date for year, month, day of month, and day of year</p>
<p>first we convert the character string date into date format. Here we are naming the new column “Date”, so R will replace character string with date formatted dates</p>
<pre class="r"><code>#### 
####  Using lubridate with dataframes and dplyr verbs
####

# going back to our tidy_clim_data dataset we see that the date column is formatted as character, not date
head(tidy_clim_data)</code></pre>
<pre><code>## # A tibble: 6 x 5
##   Date     Station PrcpIN TMaxF TMinF
##   &lt;chr&gt;    &lt;chr&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 1/1/2013 HH           0    26    22
## 2 1/1/2013 PK           0    27    19
## 3 1/1/2014 HH           0    38    27
## 4 1/1/2014 PK           0    35    24
## 5 1/1/2015 HH           0     7     0
## 6 1/1/2015 PK           0     7    -1</code></pre>
<pre class="r"><code># change format of date column
tidy_clim_data &lt;- tidy_clim_data %&gt;% 
  mutate(Date = mdy(Date))
tidy_clim_data</code></pre>
<pre><code>## # A tibble: 3,468 x 5
##    Date       Station PrcpIN TMaxF TMinF
##    &lt;date&gt;     &lt;chr&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1 2013-01-01 HH        0       26    22
##  2 2013-01-01 PK        0       27    19
##  3 2014-01-01 HH        0       38    27
##  4 2014-01-01 PK        0       35    24
##  5 2015-01-01 HH        0        7     0
##  6 2015-01-01 PK        0        7    -1
##  7 2016-01-01 HH        0       22    15
##  8 2016-01-01 PK        0       22    17
##  9 2017-01-01 HH        0.16    30    16
## 10 2017-01-01 PK        0.34    22     7
## # ... with 3,458 more rows</code></pre>
<p>now we can use mutate to create individual columns for the date components</p>
<pre class="r"><code># parse date into year, month, day, and day of year columns
tidy_clim_data &lt;- tidy_clim_data %&gt;% mutate(
  Year = year(Date),
  Month = month(Date),
  Day = mday(Date),
  Yday = yday(Date))

tidy_clim_data</code></pre>
<pre><code>## # A tibble: 3,468 x 9
##    Date       Station PrcpIN TMaxF TMinF  Year Month   Day  Yday
##    &lt;date&gt;     &lt;chr&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt;
##  1 2013-01-01 HH        0       26    22  2013     1     1     1
##  2 2013-01-01 PK        0       27    19  2013     1     1     1
##  3 2014-01-01 HH        0       38    27  2014     1     1     1
##  4 2014-01-01 PK        0       35    24  2014     1     1     1
##  5 2015-01-01 HH        0        7     0  2015     1     1     1
##  6 2015-01-01 PK        0        7    -1  2015     1     1     1
##  7 2016-01-01 HH        0       22    15  2016     1     1     1
##  8 2016-01-01 PK        0       22    17  2016     1     1     1
##  9 2017-01-01 HH        0.16    30    16  2017     1     1     1
## 10 2017-01-01 PK        0.34    22     7  2017     1     1     1
## # ... with 3,458 more rows</code></pre>
<pre class="r"><code># calculate total annual precipitation by station and year
annual_sum_precip_by_station &lt;- tidy_clim_data %&gt;%
  group_by(Station, Year) %&gt;%
  summarise(PrecipSum = sum(PrcpIN))

annual_sum_precip_by_station </code></pre>
<pre><code>## # A tibble: 10 x 3
## # Groups:   Station [?]
##    Station  Year PrecipSum
##    &lt;chr&gt;   &lt;dbl&gt;     &lt;dbl&gt;
##  1 HH       2013      29.8
##  2 HH       2014      40.8
##  3 HH       2015      25.7
##  4 HH       2016      47.0
##  5 HH       2017      25.1
##  6 PK       2013      14.7
##  7 PK       2014      19.9
##  8 PK       2015      12.6
##  9 PK       2016      17.7
## 10 PK       2017      11.8</code></pre>
</div>
</div>
<div id="challenge-exercises" class="section level1">
<h1>Challenge Exercises</h1>
</div>
<div id="exercise-1---make-data-tidy" class="section level1">
<h1>Exercise 1 - make data tidy</h1>
<ul>
<li>Create a tibble dataframe using the code below and make it tidy. Do you need to spread or gather? What are the variables? what are the observations?</li>
</ul>
<p>pregnancy &lt;- tribble( ~pregnant, ~male, ~female, “yes”, NA, 10, “no”, 20, 12 )</p>
</div>
<div id="exercise-2---data-summary-with-dplyr" class="section level1">
<h1>Exercise 2 - data summary with dplyr</h1>
<ul>
<li>use the dplyr verbs and the tidy_clim_data dataset you created above to calculate monthly average Tmin and Tmax for each station</li>
</ul>
</div>
<div id="exercise-3---make-and-parse-a-date-with-lubridate" class="section level1">
<h1>Exercise 3 - make and parse a date with lubridate</h1>
<p>make a date object out of a character string of your birthday and find the day of year it occurs on</p>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
